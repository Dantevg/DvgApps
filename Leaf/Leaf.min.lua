-- Executable Lua Archive File (.leaf) by DvgCraft - minified using lua minifier (https://mothereff.in/lua-minifier)
local a="1.0"local b={...}local c=[[local a=shell.dir()local function b()local path=shell.getRunningProgram()..".tmp"if fs.isDir("/.DvgFiles")then path="/.DvgFiles/TEMP/"..shell.getRunningProgram()..".tmp"end;fs.makeDir(path)shell.setDir(path)for c,d in pairs(files)do local e=fs.open(path.."/"..c,"w")for f=1,#d do e.writeLine(d[f])end;e.close()end end;b()if runPath and fs.exists(runPath)then shell.run(runPath)else shell.run("run")end;shell.setDir(a)fs.delete(path)]]local d=false;local e=""local f=""local g=""local h=shell.dir()local i={}function printUsage()printError("Usage:")printError("Leaf <path/to/folder> [main run path relative] <new file path> [-log]")return end;function readFolder(j)folder=fs.list(e.."/"..j)for k,l in ipairs(folder)do folder=fs.list(e.."/"..j)if fs.isDir(e.."/"..j.."/"..l)then readFolder(#j>0 and j.."/"..l or l)else i[#j>0 and j.."/"..l or l]={}local m=fs.open(e.."/"..j.."/"..l,"r")local n=m.readLine()while n do table.insert(i[#j>0 and j.."/"..l or l],n)n=m.readLine()end;m.close()if d then write("Read file: ")print(#j>0 and j.."/"..l or l)end end end end;function pack()assert(fs.isDir(e),"No such folder: "..e)if#f>0 then assert(fs.exists(e.."/"..f)and not fs.isDir(e.."/"..f),"No such file: "..e.."/"..f)else f="run"end;if string.sub(g,-5)~=".leaf"then g=g..".leaf"end;shell.setDir(e)folder=fs.list(e)if#folder<1 then error("Empty project folder")end;readFolder("")shell.setDir(h)local m=fs.open(g,"w")m.writeLine("local runPath = \""..f.."\"")m.write("local files = "..textutils.serialize(i))m.writeLine()m.write(c)m.close()end;if#b<3 then printUsage()else e=b[1]if b[3]=="-log"or b[4]=="-log"then d=true;if#b>=4 then f=b[2]g=b[3]else g=b[2]end end;pack()end
